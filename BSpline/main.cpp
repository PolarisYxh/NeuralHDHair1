//
// Created by chh3213 on 2022/11/25.
//

#include "BSpline.h"
// #include "../../matplotlibcpp.h"
// namespace plt = matplotlibcpp;
    
int main(){
float points[558]={-0.07010363,  1.73540008, -0.09777544,
       -0.07126401,  1.73009288, -0.09916385,
       -0.07219048,  1.72467339, -0.10037376,
       -0.07285681,  1.71916223, -0.10132843,
       -0.07320557,  1.7135762 , -0.10199469,
       -0.07337593,  1.70796871, -0.10256149,
       -0.07340957,  1.70235133, -0.1030725 ,
       -0.07331789,  1.69673204, -0.10354577,
       -0.07311304,  1.69111454, -0.10399976,
       -0.07278636,  1.6855036 , -0.10444392,
       -0.07238158,  1.67989695, -0.1048772 ,
       -0.07199895,  1.67428851, -0.10528821,
       -0.07157605,  1.66868544, -0.10569628,
       -0.07109879,  1.66309071, -0.10612315,
       -0.07060213,  1.65750325, -0.10657163,
       -0.07009764,  1.65192664, -0.10704071,
       -0.06953257,  1.6463654 , -0.10753807,
       -0.06940316,  1.64079928, -0.10801589,
       -0.06950553,  1.63523042, -0.10847691,
       -0.06971733,  1.62965977, -0.10894454,
       -0.0701668 ,  1.62409973, -0.10942081,
       -0.07063059,  1.61854994, -0.11000435,
       -0.07099693,  1.61300504, -0.11070098,
       -0.07114146,  1.60747015, -0.11149212,
       -0.07096238,  1.60195208, -0.11236347,
       -0.07043552,  1.5964582 , -0.1132878 ,
       -0.06988978,  1.59096122, -0.11413376,
       -0.06917783,  1.58548129, -0.11498867,
       -0.06850035,  1.57998085, -0.11579228,
       -0.0678027 ,  1.57448184, -0.11662772,
       -0.06710178,  1.56898606, -0.11750276,
       -0.0663767 ,  1.56349921, -0.11842759,
       -0.06564645,  1.55800772, -0.11934896,
       -0.06486642,  1.55251491, -0.12026605,
       -0.06397242,  1.54703391, -0.12122235,
       -0.06314077,  1.54153717, -0.12210242,
       -0.06247571,  1.53600121, -0.12282226,
       -0.06184236,  1.53045166, -0.12349527,
       -0.06123684,  1.52489126, -0.12413201,
       -0.06064377,  1.51932609, -0.12475207,
       -0.0600689 ,  1.51375782, -0.12535694,
       -0.05947579,  1.50818861, -0.1259608 ,
       -0.058862  ,  1.50261819, -0.12655964,
       -0.05823964,  1.49704671, -0.12715387,
       -0.05766241,  1.49146712, -0.12771316,
       -0.05715172,  1.48587537, -0.12822665,
       -0.05672743,  1.48027122, -0.12867898,
       -0.05635393,  1.47465789, -0.12908395,
       -0.05595972,  1.46904528, -0.12948364,
       -0.05553556,  1.4634341 , -0.12988397,
       -0.05510563,  1.45782351, -0.13026649,
       -0.05470845,  1.45220613, -0.13059518,
       -0.05435804,  1.44658315, -0.13085315,
       -0.05404958,  1.44095552, -0.1310474 ,
       -0.05378677,  1.43532431, -0.13117717,
       -0.05360068,  1.4296906 , -0.13120633,
       -0.05348585,  1.42405725, -0.13113743,
       -0.05339389,  1.41842473, -0.13102038,
       -0.05325787,  1.41279256, -0.13089906,
       -0.05299724,  1.40716159, -0.1308092 ,
       -0.05256503,  1.40154004, -0.13076779,
       -0.05201651,  1.39592779, -0.13076195,
       -0.05145014,  1.39031899, -0.1307604 ,
       -0.0509193 ,  1.38470757, -0.1307248 ,
       -0.05043622,  1.37909007, -0.13062307,
       -0.04994094,  1.37347341, -0.13048643,
       -0.04939758,  1.36786115, -0.13031705,
       -0.04882977,  1.36225235, -0.1301142 ,
       -0.04824436,  1.35664499, -0.12992427,
       -0.0476717 ,  1.35103679, -0.12973359,
       -0.04711652,  1.34542823, -0.12952018,
       -0.04658382,  1.33982038, -0.12925498,
       -0.04609678,  1.33421218, -0.12893529,
       -0.04566591,  1.32860172, -0.12859413,
       -0.04532057,  1.32298803, -0.12825039,
       -0.04507263,  1.3173697 , -0.12791359,
       -0.04486921,  1.31175029, -0.1275766 ,
       -0.04457869,  1.30613708, -0.12719044,
       -0.04433121,  1.30052328, -0.12679565,
       -0.04409675,  1.29491031, -0.12638611,
       -0.04387608,  1.28929865, -0.12595983,
       -0.04371227,  1.28368747, -0.12553397,
       -0.0437639 ,  1.2780751 , -0.12518527,
       -0.04420601,  1.27247095, -0.12500787,
       -0.04499387,  1.26689303, -0.12498809,
       -0.04595922,  1.26133645, -0.12503782,
       -0.0469877 ,  1.25579119, -0.125094  ,
       -0.04814874,  1.25027573, -0.12518333,
       -0.04959305,  1.24483454, -0.12537639,
       -0.0512879 ,  1.23946953, -0.12564255,
       -0.05310866,  1.23414862, -0.12598717,
       -0.0549874 ,  1.22884953, -0.12639505,
       -0.05676001,  1.22352004, -0.12681806,
       -0.05846644,  1.21817374, -0.12727252,
       -0.06022454,  1.21284449, -0.12775502,
       -0.06187425,  1.20748222, -0.12825197,
       -0.1070969 ,  1.71538043, -0.02327503,
       -0.10669227,  1.70992362, -0.02398296,
       -0.10601871,  1.70445442, -0.02485212,
       -0.10511085,  1.6990025 , -0.02580934,
       -0.10408124,  1.69357526, -0.02676602,
       -0.10294375,  1.68817556, -0.02787757,
       -0.10178685,  1.68280792, -0.02900508,
       -0.10063019,  1.67744577, -0.03013458,
       -0.09954669,  1.67208529, -0.031394  ,
       -0.0984956 ,  1.66667688, -0.032669  ,
       -0.09748443,  1.66124392, -0.03395046,
       -0.09663205,  1.65581906, -0.03532673,
       -0.09585083,  1.6503886 , -0.03667074,
       -0.09513272,  1.64495838, -0.0380488 ,
       -0.09446842,  1.63953841, -0.03944596,
       -0.09384191,  1.63408375, -0.04082943,
       -0.09344348,  1.62859762, -0.0422363 ,
       -0.09336002,  1.6231339 , -0.04370638,
       -0.09341271,  1.6176734 , -0.04517972,
       -0.09350367,  1.61220598, -0.04663631,
       -0.09363928,  1.60676134, -0.04810916,
       -0.09380046,  1.60133016, -0.04960492,
       -0.09394599,  1.59587479, -0.05112936,
       -0.09409443,  1.59046555, -0.05274598,
       -0.09418289,  1.58509016, -0.05443988,
       -0.09415831,  1.57970309, -0.0561587 ,
       -0.09413734,  1.57434106, -0.05790298,
       -0.09410543,  1.56893754, -0.05965917,
       -0.09418513,  1.56353879, -0.06133435,
       -0.09443832,  1.55809808, -0.06277637,
       -0.0949687 ,  1.55255008, -0.06374869,
       -0.0958542 ,  1.54701841, -0.06435367,
       -0.09690824,  1.54151177, -0.06477722,
       -0.09800084,  1.53600585, -0.06511994,
       -0.09908707,  1.53045559, -0.06541076,
       -0.10018334,  1.52491808, -0.06563367,
       -0.10126255,  1.51940155, -0.06580319,
       -0.10231491,  1.513888  , -0.06597073,
       -0.10329399,  1.50837743, -0.06617282,
       -0.10408472,  1.50282526, -0.06645846,
       -0.10462298,  1.49721313, -0.06687265,
       -0.10496807,  1.49162781, -0.06738843,
       -0.10521083,  1.4860481 , -0.06795781,
       -0.10540622,  1.48047674, -0.06855232,
       -0.10556716,  1.47491646, -0.0691679 ,
       -0.10564703,  1.46935487, -0.06984146,
       -0.1055838 ,  1.46372533, -0.07062774,
       -0.10541947,  1.45813394, -0.07148879,
       -0.10517813,  1.45258129, -0.07240526,
       -0.10478783,  1.44707024, -0.07342793,
       -0.10417726,  1.44161808, -0.07461412,
       -0.10334777,  1.43625021, -0.07596759,
       -0.10235662,  1.43088448, -0.07744785,
       -0.10132009,  1.4255383 , -0.07895689,
       -0.10025189,  1.42021906, -0.08048438,
       -0.09911701,  1.41493547, -0.08204601,
       -0.09791285,  1.4096837 , -0.08365162,
       -0.09664843,  1.40442276, -0.0852935 ,
       -0.09536902,  1.39916706, -0.08693014,
       -0.09410951,  1.39390612, -0.08851117,
       -0.09288698,  1.38861609, -0.08998668,
       -0.0917663 ,  1.3832469 , -0.09118669,
       -0.0907839 ,  1.37778664, -0.09200159,
       -0.08994275,  1.37220824, -0.09239849,
       -0.08918867,  1.3666358 , -0.09254257,
       -0.08846217,  1.36106312, -0.09255318,
       -0.08773297,  1.35548222, -0.09249826,
       -0.08699809,  1.34990311, -0.09238669,
       -0.08624338,  1.34431982, -0.0922255 ,
       -0.08546787,  1.33873308, -0.09201887,
       -0.08467846,  1.33314109, -0.09177536,
       -0.08386283,  1.32752514, -0.09151796,
       -0.08304223,  1.32193744, -0.09126551,
       -0.08223246,  1.3163836 , -0.09101833,
       -0.08145056,  1.31081736, -0.09076506,
       -0.08073413,  1.3052448 , -0.0904933 ,
       -0.08008929,  1.29966307, -0.09020127,
       -0.07950933,  1.29405499, -0.08989576,
       -0.0789789 ,  1.28840518, -0.08958877,
       -0.07855012,  1.28280735, -0.0893072 ,
       -0.07831033,  1.27724481, -0.08906541,
       -0.07826659,  1.27167892, -0.08885746,
       -0.07836476,  1.26611507, -0.0886725 ,
       -0.07862725,  1.26055431, -0.08851639,
       -0.07900196,  1.2549994 , -0.0883966 ,
       -0.07948747,  1.24945331, -0.08834907,
       -0.08012574,  1.24391878, -0.0884265 ,
       -0.08092332,  1.23837709, -0.08863448,
       -0.08185443,  1.23279917, -0.08893244,
       -0.08282785,  1.22725511, -0.08927464};
    int segments[2]={96,90};
    float result[200*3];
    MakeInterp3d2(points,segments,result,186,2);
    MakeInterp3d(points,segments,result,186,2);
}
int main1(){
//    vector<Vector2d>Ps{Vector2d (0,0),Vector2d(1,1),Vector2d(2,1),Vector2d(3,0),Vector2d(4,2)};
    vector<Vector2d>Ps{Vector2d (9.036145, 51.779661),Vector2d(21.084337, 70.084746),Vector2d(37.607573, 50.254237),Vector2d(51.893287, 69.745763),Vector2d(61.187608,  49.576271)};

    vector<double>x_ref,y_ref;
    for(int i=0;i<Ps.size();i++){
        x_ref.push_back(Ps[i][0]);
        y_ref.push_back(Ps[i][1]);
    }
    vector<double>x_,y_;

    int n =Ps.size()-1; //控制点个数-1
    int k = 3; //k阶、k-1次B样条
    Vector2d p_u(0,0);
    vector<double>bik_u(n+1);

    int flag=2;
    // cout<<"请选择：1. 均匀B样条 2.准均匀B样条  3.分段B样条 0. 退出 "<<endl;
    // cin>>flag;
    vector<double>node_vector;
    switch (flag) {
        case 1://均匀B样条
            for(int i=0;i<n+k+1;i++){
                node_vector.push_back((double)i/(n+k+1));
            }

            break;
        case 2:
            node_vector= u_quasi_uniform(n,k);

            break;
        case 3:
            node_vector = u_piecewise_B_Spline(n,k);

            break;
        default:
            return 0;
    }
    if(flag==1){
        for(double u = (double)(k-1)/(n+k+1);u<(double)(n + 2) / (n + k+1 );u+=0.005){
            for(int i=0;i<n+1;i++){
                bik_u[i]= baseFunction(i,k,u,node_vector);
                //cout<<bik_u[i]<<endl;
            }
            for(int i=0;i< Ps.size();i++){
                p_u = p_u + Ps[i]*bik_u[i];
            }
            //cout<<p_u<<endl;
            x_.push_back(p_u[0]);
            y_.push_back(p_u[1]);
            p_u=Vector2d (0,0);

        }
    }else{
        for(double u = 0;u<1;u+=0.005){
            for(int i=0;i<n+1;i++){
                bik_u[i]= baseFunction(i,k,u,node_vector);
            }
            for(int i=0;i< Ps.size();i++){
                p_u = p_u + Ps[i]*bik_u[i];
                //cout<<p_u<<","<<endl;
            }
            x_.push_back(p_u[0]);
            y_.push_back(p_u[1]);
            p_u=Vector2d (0,0);

        }
    }

    //画图
    //plt::xlim(0,1);
    // plt::plot(x_, y_,"r");
    // plt::plot(x_ref,y_ref);
    // plt::pause(0.01);
    // // save figure
    // const char* filename = "./b_spline_demo.png";
    // cout << "Saving result to " << filename << std::endl;
    // plt::save(filename);
    // plt::show();
    return 0;
}